# Why docker-compose: Orchestrates multiple containers, manages networking, and simplifies deployment
# Note: version field is obsolete in Docker Compose v2+, removed to avoid warnings

services:
  # Frontend Service
  frontend:
    build:
      context: ./React+vite
      dockerfile: Dockerfile
      args:
        # Why build arg: Vite environment variables are embedded at build time
        # Empty string means frontend uses relative URLs, nginx proxies to backend:8080
        VITE_API_URL: ""  # Relative URLs - nginx will proxy to backend service
    container_name: job-search-frontend
    ports:
      - "3000:80"  # Map host port 3000 to container port 80 (nginx)
    depends_on:
      - backend  # Wait for backend to be ready
    networks:
      - app-network
    restart: unless-stopped
    # Why restart policy: Automatically restart container if it crashes

  # Backend Service
  backend:
    build:
      context: ./Springboot
      dockerfile: Dockerfile
    container_name: job-search-backend
    ports:
      - "8080:8080"  # Map host port 8080 to container port 8080
    environment:
      # Spring Boot configuration
      - SERVER_PORT=8080
      - SPRING_DATA_MONGODB_URI=${SPRING_DATA_MONGODB_URI:-mongodb+srv://Test:test123@cluster0.f22fniz.mongodb.net/job_portal?appName=Cluster0}
      - SPRING_DATA_MONGODB_DATABASE=${SPRING_DATA_MONGODB_DATABASE:-job_portal}
      - SECURITY_JWT_SECRET=${SECURITY_JWT_SECRET:-change-me-super-secret-key-please}
      - APP_CORS_ALLOWED_ORIGINS=${APP_CORS_ALLOWED_ORIGINS:-http://localhost:3000}
      # N8N configuration (optional)
      - N8N_WEBHOOK_URL=${N8N_WEBHOOK_URL:-}
      # Admin seed configuration
      - ADMIN_SEED_ENABLED=${ADMIN_SEED_ENABLED:-true}
      - ADMIN_SEED_EMAIL=${ADMIN_SEED_EMAIL:-admin@gmail.com}
      - ADMIN_SEED_PASSWORD=${ADMIN_SEED_PASSWORD:-123456}
      - ADMIN_SEED_USERNAME=${ADMIN_SEED_USERNAME:-Admin}
      - ADMIN_SEED_COMPANY_NAME=${ADMIN_SEED_COMPANY_NAME:-Jobsaga}
      - ADMIN_SEED_COMPANY_DESCRIPTION=${ADMIN_SEED_COMPANY_DESCRIPTION:-Jobsaga company for job postings}
      - ADMIN_SEED_COMPANY_WEBSITE=${ADMIN_SEED_COMPANY_WEBSITE:-}
      - ADMIN_SEED_COMPANY_SIZE=${ADMIN_SEED_COMPANY_SIZE:-51-200}
      - ADMIN_SEED_INDUSTRY=${ADMIN_SEED_INDUSTRY:-Software}
    networks:
      - app-network
    restart: unless-stopped
    # Why environment variables: Configuration without modifying code or rebuilding images

# Shared Docker network
# Why: Allows containers to communicate using service names (e.g., frontend can reach backend via 'backend:8080')
networks:
  app-network:
    driver: bridge
    # Why bridge network: Default Docker network that allows containers to communicate with each other

